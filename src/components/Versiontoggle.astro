---
import { Image } from 'astro:assets';
import port1 from "../assets/images/portfolio1.png";
import port2 from "../assets/images/portfolio2.png";
import port3 from "../assets/images/portfolio3.png";

const { active = 1 } = Astro.props;

const portfolios = [
  { id: 1, img: port1, url: "https://colinblome.dev", name: "Version 1" },
  { id: 2, img: port2, url: "https://portfolio2.colinblome.dev", name: "Version 2" },
  { id: 3, img: port3, url: "https://portfolio3.colinblome.dev", name: "Version 3" },
];
---

<!-- Toggle Button -->
<button
  id="version-toggle-btn"
  class="version-toggle"
  aria-label="Portfolio-Version wählen"
  title="Portfolio-Version wählen"
>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" width="20" height="20"> <path d="M156.6 384.9L125.7 354c-8.5-8.5-11.5-20.8-7.7-32.2c3-8.9 7-20.5 11.8-33.8L24 288c-8.6 0-16.6-4.6-20.9-12.1s-4.2-16.7 .2-24.1l52.5-88.5c13-21.9 36.5-35.3 61.9-35.3l82.3 0c2.4-4 4.8-7.7 7.2-11.3C289.1-4.1 411.1-8.1 483.9 5.3c11.6 2.1 20.6 11.2 22.8 22.8c13.4 72.9 9.3 194.8-111.4 276.7c-3.5 2.4-7.3 4.8-11.3 7.2v82.3c0 25.4-13.4 49-35.3 61.9l-88.5 52.5c-7.4 4.4-16.6 4.5-24.1 .2s-12.1-12.2-12.1-20.9l0-105.8c-13.2 4.8-24.8 8.8-33.8 11.8c-11.4 3.8-23.7 .8-32.2-7.7z"></path> </svg>
</button>

<!-- Hint Bubble -->
<div
  id="version-hint"
  class="fixed bottom-36 right-24 h-12 flex items-center transition-all duration-500 pointer-events-none z-[9990] opacity-0 translate-x-4"
>
  <div class="bg-white text-gray-900 px-3 py-1.5 rounded-lg shadow-xl text-sm font-bold relative">
    Klick mich!
    <!-- Arrow pointing right -->
    <div class="absolute top-1/2 -right-1 -mt-1.5 w-3 h-3 bg-white transform rotate-45"></div>
  </div>
</div>

<style>
  .version-toggle {
    position: fixed;
    bottom: 120px;
    right: 20px;
    padding: 0.9rem;
    width: 55px;
    height: 55px;
    background-color: var(--bg-secondary);
    color: var(--accent);
    transition: all 0.3s ease;
    text-decoration: none;
    animation: pulseShadow 5s infinite;
    z-index: 9990;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    cursor: pointer;
    border: none;
  }

  .version-toggle:hover {
    box-shadow: 0 0 10px 2px var(--pulse-shadow-mid);
    color: var(--accent);
    background-color: var(--bg-secondary);
    transform: scale(1.1);
  }
  
  @media (max-width: 768px) {
    .version-toggle {
      bottom: 125px;
      right: 15px;
      padding: 0;
      width: 45px;
      height: 45px;
    }
  }
</style>

<!-- Modal Backdrop (Invisible) -->
<div 
  id="version-modal-backdrop"
  class="fixed inset-0 z-[9998] hidden"
></div>

<!-- Modal -->
<div 
  id="version-modal"
  class="fixed bottom-40 right-8 z-[9999] w-72 bg-[var(--bg-primary)] rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 ease-out transform origin-bottom-right scale-95 opacity-0 translate-x-8 pointer-events-none"
>
  <div class="p-4 bg-[var(--accent)]  flex justify-between items-center">
      <h3 class="font-bold text-gray-700 text-sm uppercase tracking-wider">Version wählen</h3>
      <button 
      id="version-modal-close"
      class="text-gray-400 hover:text-gray-100 w-6 h-6 flex items-center justify-center rounded-full bg-[var(--bg-primary)] hover:bg-[var(--bg-secondary)] transition-colors cursor-pointer"
      >
        &times;
      </button>
  </div>
  
  <div class="p-2 flex flex-col gap-2">
    {portfolios.map(p => (
      <a
        href={p.url}
        class:list={[
          "flex items-center flex-col gap-3 p-2 rounded-xl transition-all duration-200",
          active === p.id 
            ? "bg-[var(--accent)] border border-[var(--accent)] shadow-sm" 
            : "hover:bg-gray-50 border border-transparent hover:border-gray-100"
        ]}
        title={p.name}
        aria-current={active === p.id ? "page" : undefined}
      >
        <Image
          src={p.img}
          alt={p.name}
          class="w-64 h-32 rounded-lg object-contain shadow-sm bg-transparent"
        />
        <div class="flex-1 min-w-0">
          <div class={`font-semibold ${active === p.id ? "text-gray-300" : "text-red-600"} text-sm truncate`}>{p.name}</div>
          {active === p.id ? (
            <div class="text-xs text-blue-600 font-medium flex items-center gap-1">
              <span class="w-1.5 h-1.5 rounded-full bg-blue-600"></span>
              Aktuell
            </div>
          ) : (
            <div class="text-xs text-gray-400 group-hover:text-gray-500">
              Ansehen
            </div>
          )}
        </div>
      </a>
    ))}
  </div>
</div>

<script>
  const btn = document.getElementById('version-toggle-btn');
  const modal = document.getElementById('version-modal');
  const backdrop = document.getElementById('version-modal-backdrop');
  const closeBtn = document.getElementById('version-modal-close');
  const hint = document.getElementById('version-hint');
  let isOpen = false;

  // Hint Logic
  setTimeout(() => {
    hint?.classList.remove('opacity-0', 'translate-x-4');
    hint?.classList.add('opacity-100', 'translate-x-0');
  }, 2000);

  setTimeout(() => {
    hint?.classList.remove('opacity-100', 'translate-x-0');
    hint?.classList.add('opacity-0', 'translate-x-4');
  }, 7000);

  function toggleModal() {
    isOpen = !isOpen;
    updateModalState();
  }

  function closeModal() {
    isOpen = false;
    updateModalState();
  }

  function updateModalState() {
    if (isOpen) {
      modal?.classList.remove('scale-95', 'opacity-0', 'translate-x-8', 'pointer-events-none');
      modal?.classList.add('scale-100', 'opacity-100', 'translate-x-0');
      backdrop?.classList.remove('hidden');
    } else {
      modal?.classList.add('scale-95', 'opacity-0', 'translate-x-8', 'pointer-events-none');
      modal?.classList.remove('scale-100', 'opacity-100', 'translate-x-0');
      backdrop?.classList.add('hidden');
    }
  }

  btn?.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleModal();
  });

  closeBtn?.addEventListener('click', closeModal);
  backdrop?.addEventListener('click', closeModal);
</script>
